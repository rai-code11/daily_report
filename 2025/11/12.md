## 取り組んだ課題一覧
- ECサイト_カート機能

## わかったこと
### ORMでいう「親」と「子」ってなに？

#### ひと言で
- 子（child）：ForeignKey（外部キー）を“持っている側”。  
- 親（parent）：子が指し示す“参照される側”。  
→ つまり 「外部キーの矢印が向いている先＝親」／「外部キーを持つレコード＝子」。

---

### リレーションごとの「参照の仕方」超簡潔まとめ（多→1 / 1→多 / 多対多）

#### 多 → 1（子 → 親）※ ForeignKey
- 子から親へ：`select_related()` を使って N+1 回避（JOINで一発）
```python
# 例: CartItem(子) → Product(親)
items = CartItem.objects.filter(cart=cart).select_related("product")
for it in items:
    print(it.product.name)
```

#### 親から子へ（逆参照）
- `"<parent>.<child_set>"` または `related_name` を使って参照
```python
# related_name 未指定の場合（Djangoが自動で _set を付ける）
p = Product.objects.get(pk=1)
children = p.cartitem_set.all()
for ci in children:
    print(ci.quantity, ci.product_id)

# related_name を指定している場合
# 例: CartItem.product = ForeignKey(Product, related_name="items", ...)
p = Product.objects.get(pk=1)
children = p.items.all()
for ci in children:
    print(ci.quantity)
```

#### 1 → 多（親 → 子）※ 逆FK
- 親から子へ：`prefetch_related()` を使って N+1 回避（別クエリ＋Python結合）
```python
products = Product.objects.prefetch_related("cartitem_set")  # or "items"（related_name使用時）
for p in products:
    for ci in p.cartitem_set.all():
        print(p.name, ci.quantity)
```
- 子から親へ（FK 側なので）`select_related()` が効く
```python
items = CartItem.objects.select_related("product")
```

#### 多 ↔ 多（ManyToMany）
- どちら側からでも：`prefetch_related()` を使う
```python
# Product -> Tag
products = Product.objects.prefetch_related("tags")
for p in products:
    for t in p.tags.all():
        print(p.name, t.name)

# Tag -> Product（related_name="products" の例）
tags = Tag.objects.prefetch_related("products")
for t in tags:
    for p in t.products.all():
        print(t.name, p.name)
```

#### 覚え方（指針）
- 子→親（FK/OneToOne）：`select_related("親")`  
- 親→子（逆FK/多対多）：`prefetch_related("子")`（必要に応じて `Prefetch(...)` で絞り込み）


## 次やること
- 一覧ページのAdd to cartのテンプレート編集
- 詳細ページのAdd to cartのテンプレート編集
- 一覧ページのカート合計
- 決済ページの削除ボタンを作成
- 決済ページのカート合計、小計、商品の表示


## 感じたこと
- Djangoは機能が多くて頭がこんがらがりそうになるが、１つずつ理解していけばデータの流れがわかってくる。

## 学習時間
- ５.55h
