
## 取り組んだ課題一覧  
-a  Udemy_米国AI開発者がゼロから教えるDocker講座_s103〜127

## わかったこと

### CI/CD（継続的インテグレーションとデプロイ）

- コードを変更
- GitにPush
- GitHub Actionsなどで自動テスト（CI）
- テストに通れば自動デプロイ（CD）
  - 例：Render、Vercel、Fly.io、AWSなどに反映

---

### Dockerの鉄則

- 1つのコンテナに1つのアプリケーション
  - 例：React用コンテナ、Django用コンテナは分ける

---

### Docker Composeとは

- 複数のコンテナをまとめて管理・起動できるツール
- 設定は `docker-compose.yml` に記述する

---

### Docker Composeを使うタイミング

- `docker run` コマンドが長くなるとき  
  例：  
  `docker run -v ~/Desktop/product-register:/product-register -p 3000:3000 -it 74a8354b18cc bash`  
  ↓  
  `docker-compose up -d`

- 複数のコンテナを同時に起動したいとき
  - 例：React + Django + PostgreSQL など

---

### docker-compose.yml の役割

- 各サービス（コンテナ）の設定を記述するYAMLファイル
  - 使用するイメージ
  - ポート番号
  - ボリューム
  - 環境変数
  - ネットワーク定義 など

---

### dockerコマンドと docker-composeコマンドの対応

- イメージをビルドする  
  - docker: `docker build <build context>`  
  - compose: `docker-compose build`

- コンテナを起動する  
  - docker: `docker run <image>`  
  - compose: `docker-compose up`

- 稼働中のコンテナを確認する  
  - docker: `docker ps`  
  - compose: `docker-compose ps`

- コンテナ内に入る  
  - docker: `docker exec -it <container> bash`  
  - compose: `docker-compose exec <service> bash`

---

### よく使うdocker-composeのコマンド

- `docker-compose up --build`  
  → ビルドして起動（初回や変更後）

- `docker-compose down`  
  → コンテナを停止して削除

---

### 補足

- `docker-compose.yml` はプロジェクトのルートに配置する
- 複数環境（例：開発用と本番用）を切り替える場合は `-f` オプションでymlファイルを指定  
  例：  
  `docker-compose -f docker-compose.prod.yml up -d`

---

## Docker ComposeでRails環境を作る手順

- 作業ディレクトリの作成  
  ```bash
  mkdir myapp && cd myapp
  ```

- Rails用の Dockerfile を作成  
  - ruby:3.2 などをベースに、Railsを動かす環境を定義する

- Gemfile と Gemfile.lock を用意  
  ```ruby
  # Gemfile
  source 'https://rubygems.org'
  gem 'rails', '~> 6.1.7'
  ```

  ```bash
  # 空ファイルとして
  touch Gemfile.lock
  ```

- Dockerfile の編集とバージョン互換確認  
  ```dockerfile
  FROM ruby:3.2
  WORKDIR /app
  COPY Gemfile Gemfile.lock ./
  RUN bundle install
  COPY . .
  ```

- docker-compose.yml を作成（まずはRailsコンテナのみでもOK）

- docker-compose build でイメージ作成  
  ```bash
  docker-compose build
  ```

- docker-compose up -d でRailsコンテナ起動  
  ```bash
  docker-compose up -d
  ```

- docker-compose exec web bash でコンテナに入る  
  ```bash
  docker-compose exec web bash
  ```

- コンテナ内で rails new を実行  
  ```bash
  rails new . --force --database=postgresql --skip-test
  ```

- DBがないのでエラーが出る → docker-compose.yml にDBサービスを追加  
  ```yaml
  services:
    db:
      image: postgres
      environment:
        POSTGRES_PASSWORD: password

    web:
      build: .
      ports:
        - "3000:3000"
      volumes:
        - ".:/app"
      depends_on:
        - db
  ```

- database.yml の `host: db` に修正

- 修正内容を反映させて起動確認  
  ```bash
  docker-compose down
  docker-compose build
  docker-compose up -d
  docker-compose exec web bash
  ```

  ```bash
  rails db:create
  rails s
  ```

  → `http://localhost:3000` にアクセスしてRails起動確認

---

### CI/CDの流れ（開発→デプロイ）

- featureブランチを作成  
  例：  
  `git checkout -b feature/login`

- コードを変更

- git add .（stagingにあげる）

- git commit  
  例：  
  `git commit -m "ログイン機能を追加"`

- git push origin feature/login

- GitHubでPull Request（PR）を作成

- PR作成と同時にテストが走る（CI）

- レビューを受けて、PRをmainにマージ

- mainにpushされたタイミングでCIが再び起動（CD）

- 本番環境に新しいバージョンのアプリが反映される

## 次やること
-a 入門Dockerを読む 

-b  ブログの修正

## 感じたこと
-a  モニターを購入し設置したら作業効率が上がった。

-b  開発からデプロイまで一貫してできるようになるとかなり快適に開発できるし、仕事の効率が上がると感じるのでDockerをマスターできるように復習する。

## 学習時間
-6.05h
