
## 取り組んだ課題一覧
- ECサイト_詳細ページ

## わかったこと
### Heroku デプロイ後に発生する「旧アプリ名残り」問題の整理と対処

### 状況

Heroku のデプロイは成功しているが、ログには以下のような出力がある。

```
remote: Operations to perform:
remote:    Apply all migrations: admin, auth, contenttypes, product_details, product_list, sessions
remote: Running migrations:
remote:    No migrations to apply.
```

これは以下を意味する。

1. Heroku はまだ `product_details` と `product_list` を認識している。  
2. 新しい `product` アプリが読み込まれていない。  
3. `product` のマイグレーションが実行されていないため、Heroku の DB にテーブルが存在しない。

結果として、サーバーが起動してもテーブル参照時にエラーが発生し、接続リセット（ERR_CONNECTION_RESET）になる。

---

### 対処手順

### 1. settings.py の修正

`INSTALLED_APPS` から古いアプリ名を削除し、新しい `product` だけを残す。

```python
# settings.py

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',

    # 削除する
    # 'product_details',
    # 'product_list',

    # 統合後のアプリのみ残す
    'product',
]
```

---

### 2. Heroku のデータベースを整理して再マイグレーション

Heroku に接続して、不要なマイグレーション履歴を削除する。

```bash
# Heroku の Postgres に接続
heroku pg:psql

# 不要な履歴を削除
DELETE FROM django_migrations WHERE app = 'product';
DELETE FROM django_migrations WHERE app = 'product_list';
DELETE FROM django_migrations WHERE app = 'product_details';

# 終了
\q
```

続いて、新しいテーブルを作成するためにマイグレーションを実行する。

```bash
heroku run python manage.py migrate
```

---

### 3. 設定をコミットして再デプロイ

修正をGitに反映させて再デプロイする。

```bash
git add .
git commit -m "Fix: Remove old app names from INSTALLED_APPS"
git push heroku main
```

---

### 結果

この修正によって以下の状態になる。

- Heroku が古い `product_details` / `product_list` を無視する  
- `product` アプリのマイグレーションが実行され、テーブルが作成される  
- アプリケーションが正常に起動し、DB参照時のエラーが解消される

最終的に、Heroku 上の URL にアクセスしても接続リセットが発生せず、正常にページが表示されるようになる。


## 次やること
- ECサイト詳細ページ
- 


## 感じたこと
- 

## 学習時間
- 5.3h
