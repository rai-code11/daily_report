## 取り組んだ課題一覧
- Django_詳細ページ作成
## わかったこと
### Django DetailView のリレーション・コンテキスト処理まとめ

### ビュー定義（product_details/views.py）

```python
from django.shortcuts import render
from django.views.generic.detail import DetailView
from .models import ProductList, ProductDetails

class ProductDetailsView(DetailView):
    # DBから取得するモデル
    model = ProductList
    # 使用するテンプレート
    template_name = "product_details/product_details.html"
    # テンプレート上で使う変数名
    context_object_name = "product_details"

    def get_context_data(self, **kwargs):
        context = super().get_context_data(**kwargs)
        try:
            # self.object は ProductList のインスタンス
            # .productdetails は OneToOneField で紐づく ProductDetails を取得
            context["details"] = self.object.productdetails
        except ProductDetails.DoesNotExist:
            # 関連する ProductDetails が存在しない場合
            context["details"] = None
        return context
```

---

### コンテキスト辞書の仕組み

DetailView の get_context_data は、テンプレートへ渡すデータをまとめる辞書（context）を構築するメソッド。

1. `super().get_context_data(**kwargs)` で親クラスから既存データを取得する（例：product_list）
2. `context["details"] = self.object.productdetails` で新しいキーを追加する
3. `return context` によりテンプレートへ渡す辞書を返す

これにより、テンプレートでは次のようにアクセスできる。

```html
{{ product_details.name }}
{{ details.context }}
```

---

### OneToOneField のリレーション取得

- `self.object`: 現在表示中の ProductList インスタンス  
- `.productdetails`: ProductDetails モデル（1対1で紐づく詳細情報）

存在しない場合に `ProductDetails.DoesNotExist` が発生するため、必ず `try...except` で例外処理を行う。

---

### 関連商品の取得例（QuerySet チェーン）

```python
related_products = (
    ProductList.objects
    .exclude(id=self.object.id)
    .select_related("productdetails")
    .order_by("-productdetails__created_at")[:4]
)
```

上記のクエリセットでは以下のような処理を行っている。

1. `ProductList.objects` でクエリの開始点（マネージャー）を作成
2. `.exclude(...)` で表示中の商品IDを除外
3. `.select_related("productdetails")` で関連データをJOINして効率的に取得
4. `.order_by("-productdetails__created_at")` で新しい順に並べ替え
5. `[:4]` で4件に制限（LIMIT 4）

---

### エラー原因と解決

発生箇所:
```python
context["product_details"] = self.object.productdetails
```

原因:
ProductDetails がまだ作成されていないため、`self.object.productdetails` にアクセスできず `DoesNotExist` 例外が発生している。

解決策:
例外を `try...except` で捕捉し、存在しない場合は `None` を返す。

---

### まとめ

- ビューの目的: 単一の ProductList と対応する ProductDetails を表示する
- 追加データの取得: get_context_data() 内で context に追加する
- 例外対策: try...except ProductDetails.DoesNotExist で安全に処理
- 関連商品取得: QuerySet をチェーンして効率的にデータを取得する

このように記述することで、DetailView と OneToOne リレーションの動きが明確になり、テンプレート設計やデバッグがスムーズに行える。

## 次やること
- 詳細ページ作成


## 感じたこと
- 

## 学習時間
- 5.00h
